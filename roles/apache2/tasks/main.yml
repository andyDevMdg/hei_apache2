---
 - name: Installation de apache2
    become: yes
    ansible.builtin.apt: 
      name: apache2
      update_cache: yes
      state: latest

  - name: Start apache2
    become: yes
    service:
      name: apache2
      state: started
      enabled: true
  
  - name: Delete default.conf
    become: yes
    file:
      path: /etc/apache2/sites-enabled/000-default.conf
      state: absent
      notify: apache2 reload

  - name : Creation de dossier des domaines
    become: yes
    file:
      path: /home/root/{{ domain }}
      state: directory
      owner: root
  
  - name: Lien vers www
    become: yes
    file:
      src: /home/root/{{ domain }}
      dest: /var/www/{{ domain }}
      state: link
  
  - name: Cr√©ation de la configuration apache2
    template:
      src: templates/apache2.j2
      dest: /etc/apache2/sites-available/{{ domain }}

  - name: Activation du domain {{ domain }}
    file: 
      src: /etc/apache2/sites-available/{{ domain }}
      dest: /etc/apache2/sites-enabled/{{ domain }}
      state: link
    notify: yes

